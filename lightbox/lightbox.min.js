//************************************************************************
//  USER OPTIONS
const options = {
    'captions': false, // enable/disable captions*
    // * use captions.xml to edit captions
    'filters' : true, // enable/disable category filters
    'loadTime': 1000, // in milliseconds - minimum time period loader boxes 
    // are shown
    'rollover': "zoom", //thumbnail hover animations*
    //* zoom, slide, drop, or none.
    'slider': "slide" //lightbox slider animation*
    //* zoom, slide, or none.               
}

Object.freeze(options);const{captions:captions,filters:filters,loadTime:loadTime,rollover:rollover,slider:slider}=options,filePath="./lightbox/";var resizeDone,imgCount,captionsLoaded=!1,notLoaded=!0,nav=!1,type="all";if(window.addEventListener("resize",()=>{clearTimeout(resizeDone),resizeDone=setTimeout(()=>{"none"!=window.getComputedStyle(document.querySelector(".lightbox")).getPropertyValue("display")&&setNav()},50)}),window.addEventListener("scroll",()=>{checkTop()}),checkTop=(()=>{let e=window.scrollY,t=document.getElementById("top");e>=900?(t.style.display="block",t.addEventListener("click",()=>{window.scrollTo(0,0)})):t.style.display="none"}),checkTop(),filters){var sorts=Array.from(document.querySelectorAll(".sorting ul li a")),dirs=[];sorts.forEach(e=>{"all"!==e.innerHTML&&dirs.push(e.innerHTML)})}else{let e=document.querySelector(".sorting");null!==e&&(e.style.display="none")}if(captions){document.querySelector(".loader-captions").style.display="block";let e=new XMLHttpRequest;filters?e.open("GET",filePath+"captions.php?dirs="+dirs):e.open("GET",filePath+"captions.php?"),e.send(),e.onreadystatechange=function(){4==this.readyState&&200==this.status&&(captionsLoaded=!0)}}let getImages=e=>{let t=new XMLHttpRequest;filters?t.open("GET",filePath+"full.php?filePath="+filePath+"&type="+type+"&dirs="+dirs):t.open("GET",filePath+"full.php?filePath="+filePath+"&type="+type),t.send(),t.onreadystatechange=function(e){if(4==this.readyState&&200==this.status){for(imgArray=JSON.parse(e.currentTarget.response),imgCount=imgArray.length,x=0;x<=imgCount-1;x++){let e=document.querySelector("#gallery");e.insertAdjacentHTML("beforeend",'<div class="loader"><img src="'+filePath+'/images/image-dummy.png" class="fadeRight" alt=""/></div>')}loadThumbs(type)}}};if(getImages(),loadThumbs=(e=>{if(notLoaded=!0,filters){const e=document.querySelector(".warn");null!==e&&(e.innerHTML="")}const t=document.querySelectorAll(".thumb");if(t.length>0){let e=Array.from(t);e.forEach(e=>{e.parentNode.removeChild(e)})}"none"!=window.getComputedStyle(document.querySelector(".loader-captions")).getPropertyValue("display")&&document.querySelector(".loader-captions").setAttribute("style","display:none");try{let t=new XMLHttpRequest;t.open("POST",filePath+"thumbs.php",!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),filters?t.send("filePath="+filePath+"&imgCount="+imgCount+"&fArray="+imgArray+"&type="+e+"&dirs="+dirs):t.send("filePath="+filePath+"&imgCount="+imgCount+"&fArray="+imgArray+"&type="+e),t.onreadystatechange=function(t){if(4==this.readyState&&200==this.status){thumbArray=JSON.parse(t.currentTarget.response);let o=document.getElementById("gallery");for(x=0;x<=thumbArray.length-1;x++)o.insertAdjacentHTML("beforeEnd",'<div class="thumb"><a href="#"><img src="'+thumbArray[x]+'" /></a></div>');let l,i=document.querySelectorAll(".thumb img");if(i.forEach((e,t)=>{t==i.length-1&&(l=i[i.length-1])}),void 0===l){if(filters){let t=document.querySelector(".warn");null!==t?"all"!==e?t.insertAdjacentHTML("beforeend","<h3>Doesn&#39;t look like we have any images in the "+e+" category!<br> Set filters to false in the options if you are not using filters.</h3>"):t.insertAdjacentHTML("beforeend","<h3>Doesn&#39;t look like we have any images in the filtering subfolders.<br> Set filters to false in the options if you are not using filters.</h3>"):console.log("Doesnt look like we have any images in the "+e+" category.")}const t=document.querySelectorAll(".loader");if(t.length>0){let e=Array.from(t);e.forEach(e=>{e.parentNode.removeChild(e)})}if(filters)for(let e of sorts)e.setAttribute("style","cursor:pointer; opacity:1;");return void(notLoaded=!1)}l.addEventListener("load",()=>{for(let e of i){let t=e.naturalWidth,o=e.naturalHeight;o>t&&e.closest("div").classList.add("vertical")}let e=o.clientHeight;setTimeout(function(){let t=document.querySelectorAll(".thumb");t.forEach(e=>{e.style.display="block",e.classList.add("fadein")});let l=document.querySelectorAll(".loader");if(l.forEach(e=>{e.remove()}),o.setAttribute("style","min-height:"+e+"px"),o.setAttribute("style","height:auto"),filters)for(let e of sorts)e.setAttribute("style","cursor:pointer; opacity:1;");notLoaded=!1;let i=document.querySelectorAll(".thumb img");i.forEach(e=>{e.addEventListener("mouseenter",e=>{"zoom"==rollover?e.target.classList.add("thumb-zoom"):"slide"==rollover?e.target.classList.add("thumb-slide"):"drop"==rollover&&e.target.classList.add("thumb-drop")}),e.addEventListener("mouseleave",e=>{"zoom"==rollover?e.target.classList.remove("thumb-zoom"):"slide"==rollover?e.target.classList.remove("thumb-slide"):"drop"==rollover&&e.target.classList.remove("thumb-drop")})})},loadTime)})}}}catch(e){return void alert("something went wrong:  "+e.message)}}),filters){let e=document.querySelector(".sorting");null===e?console.log("The sorting div element is missing...did you delete from the index.html?"):e.addEventListener("click",t=>{if("A"!==t.target.tagName||notLoaded)return;let o=e.getElementsByTagName("a");for(let e of o)e.setAttribute("style","cursor:wait; opacity:0.3;"),e.classList.remove("active"),t.target==e&&(sorting=!0,type=e.innerHTML,e.classList.add("active"));sorting&&getImages()})}var slowLoad=!1;let gal=document.getElementById("gallery");gal.addEventListener("click",e=>{let t=e.target;if("IMG"!==t.tagName)return;if(notLoaded)return;let o,l=setTimeout(()=>{slowLoad=!0},100);pos=window.scrollY,document.getElementById("container").setAttribute("style","display:none");let i=document.querySelector(".lightbox"),r=document.querySelector(".loader-img"),s=document.querySelector(".caption"),n=t.getAttribute("src"),a=n.replace("/thumbs","/fullsize");i.setAttribute("style","display:inline-grid"),i.classList.add("fadein");let c=i.getElementsByTagName("*"),d=Array.prototype.slice.call(c);for(elem of d)elem!==r&&elem.setAttribute("style","display:none");try{for(x=0;x<imgArray.length;x++){if(imgArray[x]==a){o=!0;let e=document.querySelector(".lightbox img");e.src=imgArray[x],e.onload=(()=>{for(elem of(clearTimeout(l),d))elem!==r&&elem.setAttribute("style","display:block;"),captions||elem===s&&elem.setAttribute("style","display:none;");slowLoad||r.setAttribute("style","display:none"),document.body.setAttribute("style","overflow:hidden"),setTimeout(()=>{document.getElementById("container").setAttribute("style","display:block"),window.scrollTo(0,pos)},50),"slide"==slider?(e.className="slideLeft",setTimeout(function(){e.classList.remove("slideLeft")},400)):"zoom"==slider?(e.className="zoomOut",setTimeout(function(){e.classList.remove("zoomOut")},400)):(e.className="fadeIn",setTimeout(function(){e.classList.remove("fadein")},400)),setNav()});let t=x;captions&&(captionsLoaded?(nav=!1,loadCaptions(t)):console.log("There was a problem loading the captions. Try clearing the browser cache and refreshing."));break}o=!1}if(!o){alert("Couldn't find a matching image.");let e=document.querySelector(".loader-img");"none"!=window.getComputedStyle(e).getPropertyValue("display")&&e.setAttribute("style","display:none");let t=document.getElementById("container");return void("none"===window.getComputedStyle(t).getPropertyValue("display")&&(t.setAttribute("style","display:block"),t.classList.add("fadein")))}}catch(e){return void alert(e.message)}});let loadCaptions=e=>{let t=new XMLHttpRequest;t.open("GET",filePath+"captions.json"),t.send(),t.onload=function(t){if(4==this.readyState&&200==this.status){let o=JSON.parse(t.currentTarget.response),l=document.querySelector(".caption");if("all"!=type)for(const[t,i]of Object.entries(o))t===type&&(nav&&(p?e=intPrev:n&&(e=intNext)),Object.values(i).forEach((t,o)=>{if(o===e){let e=Object.values(t);l.innerHTML="",l.insertAdjacentHTML("beforeend","<p>"+e+"</p>")}}));else{nav&&(p?e=intPrev:n&&(e=intNext));let t=-1;for(const[i,r]of Object.entries(o))for(const o of Object.values(r)){let i;if(t++,t===e){i=filters?Object.values(o):"object"==typeof o?Object.values(o):o,l.innerHTML="",l.insertAdjacentHTML("beforeend","<p>"+i+"</p>");break}}}}}};document.addEventListener("mouseup",e=>{let t=document.querySelector(".lightbox");if("none"!=window.getComputedStyle(t).getPropertyValue("display")){let t=document.querySelector(".lightbox"),l=t.getElementsByTagName("*"),i=Array.prototype.slice.call(l);for(elem of i)if(elem==e.target)var o=!0;o||(closePhoto(),o=!0)}}),closePhoto=(()=>{window.scrollTo(0,pos);let e=document.querySelector(".lightbox img");e.src="",document.querySelector(".lightbox").setAttribute("style","display:none"),document.body.setAttribute("style","overflow:visible")}),setNav=(()=>{let e=window.innerWidth-25,t=document.querySelector(".lightbox-nav"),o=document.querySelector(".closeP");t.setAttribute("style","display:block; margin-left:"+-e/2+"px; width:"+e+"px"),o.setAttribute("style","display:block; margin-left:"+-e/2+"px; width:"+e+"px")});let ltbx=document.querySelector(".lightbox");ltbx.onclick=(e=>{let t=document.querySelector(".nav-prev-photo"),o=document.querySelector(".nav-next-photo"),l=document.querySelector(".closeP"),i=t.children.item(0),r=o.children.item(0),s=l.getElementsByTagName("*"),a=Array.prototype.slice.call(s);for(elem of a)elem==e.target&&closePhoto();i==e.target&&getPrevNxt(p=!0,n=!1),r==e.target&&getPrevNxt(p=!1,n=!0)}),getPrevNxt=(()=>{let e,t=document.querySelector(".lightbox img").getAttribute("src");for(var o=0;o<=imgArray.length-1;o++)if(t==imgArray[o]&&(e=!0),e)return 0==o?void navLinks(intPrev=imgArray.length-1,intNext=o+1,p,n):o==imgArray.length-1?void navLinks(intPrev=o-1,intNext=0,p,n):void navLinks(intPrev=o-1,intNext=o+1,p,n)}),navLinks=(()=>{let e=document.querySelector(".loader-img"),t=document.querySelector(".lightbox"),o=t.querySelector(".lightbox img"),l=document.querySelector(".caption"),i=t.getElementsByTagName("*"),r=Array.prototype.slice.call(i);if(slowLoad)for(elem of r)elem!==e&&elem.setAttribute("style","display:none");try{p?(o.innerHTML="",o.src=imgArray[intPrev]):n&&(o.innerHTML="",o.src=imgArray[intNext]),o.onload=prevNext=(()=>{for(elem of r)elem!==e&&elem.setAttribute("style","display:block;"),captions||elem===l&&elem.setAttribute("style","display:none;");"slide"==slider?p?(o.className="slideRight",setTimeout(function(){o.classList.remove("slideRight")},400)):n&&(o.className="slideLeft",setTimeout(function(){o.classList.remove("slideLeft")},400)):"zoom"==slider&&(o.className="zoomOut",setTimeout(function(){o.classList.remove("zoomOut")},400)),setNav(),captions&&(captionsLoaded?(nav=!0,loadCaptions()):console.log("There was a problem loading the captions. Try clearing the browser cache and refreshing."))})}catch(e){return void alert(e.message)}}),document.addEventListener("keydown",e=>{let t=document.querySelector(".closeP");"none"!=window.getComputedStyle(t).getPropertyValue("display")&&("ArrowLeft"===e.key&&getPrevNxt(p=!0,n=!1),"ArrowRight"===e.key&&getPrevNxt(p=!1,n=!0),"Escape"===e.key&&closePhoto())});let initialX=null,currentX=null,initialY=null,currentY=null,zooming=!1,lightbx=document.querySelector(".lightbox");lightbx.addEventListener("touchstart",e=>{initialX=e.touches[0].screenX,initialY=e.touches[0].screenY,zooming=!1}),lightbx.addEventListener("touchmove",e=>{let t=document.querySelector(".lightbox img");e.touches.length>1&&(zooming=!0),t.classList.contains("slideRight")?t.classList.remove("slideRight"):t.classList.contains("slideLeft")&&t.classList.remove("slideLeft");let o=e.touches[0].screenX,l=e.touches[0].screenY,i=initialX-o,r=initialY-l;Math.abs(i)>Math.abs(r)&&(t.className=i>0?"swipeLeft":"swipeRight")}),lightbx.addEventListener("touchend",e=>{let t=document.querySelector(".lightbox img"),o=e.changedTouches[e.changedTouches.length-1].screenX,l=e.changedTouches[e.changedTouches.length-1].screenY;if(t.classList.contains("swipeLeft")&&t.classList.remove("swipeLeft"),t.classList.contains("swipeRight")&&t.classList.remove("swipeRight"),zooming)return;if(null===initialX||null===o)return;let i=initialX-o,r=initialY-l;return Math.abs(i)>Math.abs(r)&&(i>35?getPrevNxt(p=!1,n=!0):i<-35&&getPrevNxt(p=!0,n=!1)),t.classList.contains("swipeLeft")&&t.classList.remove("swipeLeft"),void(t.classList.contains("swipeRight")&&t.classList.remove("swipeRight"))});